# GitHub Global - 实现任务清单

## 设计文档

- 技术设计: [design.md](./design.md)
- API 规范: [openapi.yaml](./api-docs/openapi.yaml) - 基于 OpenAPI 3.0.3 标准

---

# 第一阶段：后端开发

## 1. 项目基础设施

- [x] 1.1 创建 Next.js (App Router) + TypeScript 项目结构
- [x] 1.2 配置环境变量管理（.env 示例文件）
- [x] 1.3 配置 MySQL 8.0 数据库连接和 Prisma ORM
- [x] 1.4 配置 Redis 连接（任务队列、缓存、限流）
- [x] 1.5 配置 Docker 多阶段构建和 Docker Compose

## 2. GitHub OAuth 认证模块

- [x] 2.1 在 GitHub 开发者设置中创建 OAuth App
- [x] 2.2 实现 GitHub OAuth Web Application Flow
- [x] 2.3 实现 OAuth 回调处理和 token 交换
- [x] 2.4 实现 AES-256-GCM 加密工具类
- [x] 2.5 实现用户会话管理
- [x] 2.6 实现 GitHub Token 加密存储
- [x] 2.7 实现用户登出功能
- [x] 2.8 实现 CSRF 防护
- [x] 2.9 实现白名单用户管理

## 3. 用户设置 API

- [x] 3.1 创建用户设置 API 端点
- [x] 3.2 实现 OpenRouter API Key 加密存储
- [x] 3.3 实现 API Key 格式验证
- [x] 3.4 实现平台托管 AI 额度管理
- [x] 3.5 实现多级限流机制

## 4. 仓库管理 API

- [x] 4.1 实现 GitHub 仓库列表获取 API
- [x] 4.2 实现仓库导入功能
- [x] 4.3 实现仓库去重检查
- [x] 4.4 实现仓库数据库模型和迁移

## 5. 文件树 API

- [x] 5.1 实现 GitHub API 获取仓库内容
- [x] 5.2 实现递归文件树构建
- [x] 5.3 实现大仓库分页/懒加载

## 6. 翻译配置 API

- [x] 6.1 定义支持的语言列表常量
- [x] 6.2 实现文件选择功能
- [x] 6.3 实现 .github-global-ignore 规则解析
- [x] 6.4 实现 OpenRouter 可用模型列表获取

## 7. 翻译引擎核心

- [x] 7.1 实现 OpenRouter API 客户端
- [x] 7.2 实现 Markdown 翻译 prompt 模板
- [x] 7.3 实现大文件分块翻译
- [x] 7.4 实现翻译结果合并逻辑
- [x] 7.5 创建翻译任务队列

## 8. 异步任务管理

- [x] 8.1 实现翻译任务状态机
- [x] 8.2 实现任务进度跟踪
- [x] 8.3 实现重试机制
- [x] 8.4 实现任务状态查询 API

## 9. 翻译预览 API

- [x] 9.1 实现翻译结果存储
- [x] 9.2 实现原文/译文对比 API

## 10. 变更检测

- [x] 10.1 实现 Git commit SHA 对比逻辑
- [x] 10.2 实现变更文件列表获取
- [x] 10.3 实现 baseline SHA 记录和更新
- [x] 10.4 处理 force push 回退逻辑

## 11. GitHub 提交

- [x] 11.1 实现翻译结果提交到 GitHub
- [x] 11.2 实现翻译目录结构创建
- [x] 11.3 实现 commit 消息生成
- [x] 11.4 处理提交冲突检测
- [x] 11.5 实现 PR 创建功能

## 12. README 语言链接

- [x] 12.1 实现 README 结构分析
- [x] 12.2 实现语言切换链接生成
- [x] 12.3 实现链接插入位置确定
- [x] 12.4 实现现有语言区域更新

## 13. 健康检查

- [x] 13.1 实现健康检查端点

---

# 第二阶段：前端开发

## 14. 用户设置界面

- [x] 14.1 实现用户设置页面前端

## 15. 仓库管理界面

- [x] 15.1 创建仓库列表页面前端

## 16. 文件树界面

- [x] 16.1 创建仓库文件树组件前端

## 17. 翻译配置界面

- [x] 17.1 实现语言选择组件
- [x] 17.2 创建翻译配置页面前端

## 18. 任务进度界面

- [x] 18.1 创建任务进度展示组件

## 19. 翻译预览界面

- [x] 19.1 创建翻译预览页面

## 20. 主界面

- [x] 20.1 创建项目首页
- [x] 20.2 创建导航栏和布局
- [x] 20.3 实现响应式设计
- [x] 20.4 添加加载状态和错误提示
- [x] 20.5 添加国际化（i18n）

---

# 第三阶段：部署与测试

- [x] 21.1 编写单元测试
- [x] 21.2 编写集成测试
- [x] 21.3 配置 CI/CD 流水线
- [ ] 21.4 生产环境部署验证
- [x] 2.2 实现 GitHub OAuth Web Application Flow (Authorization Code Flow)
- [x] 2.3 实现 OAuth 回调处理和 token 交换
- [x] 2.4 实现 AES-256-GCM 加密工具类
- [x] 2.5 实现用户会话管理（Session with HttpOnly, Secure, SameSite）
- [x] 2.6 实现 GitHub Token 加密存储
- [x] 2.7 实现用户登出功能
- [x] 2.8 实现 CSRF 防护（OAuth state 参数验证）
- [x] 2.9 实现白名单用户管理

## 3. 用户设置管理

- [x] 3.1 创建用户设置 API 端点
- [x] 3.2 实现 OpenRouter API Key 加密存储
- [x] 3.3 实现 API Key 格式验证
- [x] 3.4 实现用户设置页面前端
- [x] 3.5 实现平台托管 AI 额度管理
- [x] 3.6 实现多级限流机制（全局/用户/IP/仓库）

## 4. 仓库管理模块

- [x] 4.1 实现 GitHub 仓库列表获取 API
- [x] 4.2 实现仓库导入功能
- [x] 4.3 实现仓库去重检查
- [x] 4.4 实现仓库数据库模型和迁移
- [x] 4.5 创建仓库列表页面前端

## 5. 文件树展示

- [x] 5.1 实现 GitHub API 获取仓库内容
- [x] 5.2 实现递归文件树构建
- [x] 5.3 实现大仓库分页/懒加载
- [x] 5.4 创建仓库文件树组件前端

## 6. 翻译配置模块

- [x] 6.1 定义支持的语言列表常量
- [x] 6.2 实现语言选择组件
- [x] 6.3 实现文件选择功能
- [x] 6.4 实现 .github-global-ignore 规则解析
- [x] 6.5 实现 OpenRouter 可用模型列表获取
- [x] 6.6 创建翻译配置页面前端

## 7. 翻译引擎核心

- [x] 7.1 实现 OpenRouter API 客户端
- [x] 7.2 实现 Markdown 翻译 prompt 模板
- [x] 7.3 实现大文件分块翻译
- [x] 7.4 实现翻译结果合并逻辑
- [x] 7.5 创建翻译任务队列（内存队列 MVP）

## 8. 异步任务管理

- [x] 8.1 实现翻译任务状态机（pending/running/completed/failed）
- [x] 8.2 实现任务进度跟踪
- [x] 8.3 实现重试机制（指数退避，最多3次）
- [x] 8.4 实现任务状态查询 API
- [x] 8.5 创建任务进度展示组件

## 9. 翻译预览功能

- [x] 9.1 实现翻译结果存储
- [x] 9.2 实现原文/译文对比 API
- [x] 9.3 创建翻译预览页面

## 10. 变更检测模块

- [x] 10.1 实现 Git commit SHA 对比逻辑
- [x] 10.2 实现变更文件列表获取
- [x] 10.3 实现 baseline SHA 记录和更新
- [x] 10.4 处理 force push 回退逻辑

## 11. GitHub 提交功能

- [x] 11.1 实现翻译结果提交到 GitHub
- [x] 11.2 实现翻译目录结构创建
- [x] 11.3 实现 commit 消息生成
- [x] 11.4 处理提交冲突检测
- [x] 11.5 实现 PR 创建功能（可选）

## 12. README 语言链接处理

- [x] 12.1 实现 README 结构分析 AI prompt
- [x] 12.2 实现语言切换链接生成
- [x] 12.3 实现链接插入位置确定
- [x] 12.4 实现现有语言区域更新
- [x] 12.5 实现子目录 README 路径调整

## 13. 前端界面完善

- [x] 13.1 创建项目首页
- [x] 13.2 创建导航栏和布局
- [x] 13.3 实现响应式设计
- [x] 13.4 添加加载状态和错误提示
- [x] 13.5 添加国际化（i18n）

## 14. 部署与测试

- [x] 14.1 配置 Docker 多阶段构建（node:20-alpine）
- [x] 14.2 配置 Docker Compose（app, mysql, redis 服务）
- [x] 14.3 实现数据库自动迁移
- [x] 14.4 编写单元测试（目标 80%+ 覆盖率）
- [x] 14.5 编写集成测试
- [x] 14.6 配置 CI/CD 流水线
- [ ] 14.7 生产环境部署验证
- [x] 14.8 实现健康检查端点（/api/health）
